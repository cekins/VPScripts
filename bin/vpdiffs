#!/bin/bash

# TODO: desc

# Import functions
libDir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/../lib/"
source ${libDir}functions.sh

# Check for flags
convertVP=false
while getopts "c" argOpts
do
	case $argOpts in
		c)
			convertVP=true
			;;
	esac
done

# Get screenshot directory
ssDir=$(getScreenshotDir)

# Iterate over screenshots in folder
for ssFile in $(ls "$ssDir")
do
	# Extract vp name from each screenshot
	vpName=$(getVPName $ssFile)
	vpDir=$(getVPDir)

	matchingVPs=$(getMatchingVPs $vpName)

	for vpFile in $matchingVPs
	do
		# Print name of current comparison
		echo "${vpFile#${vpDir}}:"
		# Generate comparison percent 
		echo -e "$(/opt/squish-6.4/bin/testvp --image "$vpFile" "junk" "$ssDir$ssFile")\n"
		# Compare via utility
		/opt/squish-6.4/bin/vpdiff "$vpFile" "junk" "$ssDir$ssFile"
	done

	# Check if screenshot corresponds to verification points
	if  $convertVP  && [[ -n $matchingVPs ]]
	then
		# Prompt user for conversion
		read -p "Convert image to VP (y/n)?" yn
		case $yn in 
			[Yy]* ) 
				# Determine name for new vp 
				hightestVP=${matchingVPs[0]}
				echo $hightestVP
				echo "END"
		esac
	fi	
				

done
